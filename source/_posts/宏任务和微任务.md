---
uuid: 5
title: 宏任务和微任务
categories:
- js
tags:
- 宏任务和微任务
---

## 事件循环
> js主线程不断的循环往复的从任务队列中读取任务，执行任务，其中运行机制称为事件循环。

## 异步任务类型
>微任务的优先级高于宏任务。
* 宏任务（setTimeOut, setImmediate, setInterVal, I/O,UI渲染）
* 微任务（process.nextTick, promise, MutationObserver）

## 微任务和任务及宏任务之间的区别
* 每个事件循环都有一个微任务队列
* 每个事件循环都有一个或多个宏任务队列
* 一个任务可以放入宏任务也可以放入微任务队列中
* 每一次事件循环，会首先执行微任务，执行完成之后会提取宏任务中的一个任务加入微任务，接着继续执行微任务队列，依次执行下去直到任务执行结束

## js异步执行机制
>js主线程拥有一个执行栈（同步任务）和一个任务队列（微任务），主线程会依次执行代码
* 当遇到函数（同步）时会将函数入栈，函数运行结束后再将该函数出栈
* 当遇到异步操作时，这些任务会返回一个值让主线程不在此阻塞，而真正的任务将交给浏览器执行，浏览器执行结束后会将任务事先定义好的回调函数加入响应的任务队列中。
* 当js主线程清空执行栈之后会按先入先出的顺序读取微任务中的回调函数并将该函数入栈，继续运行执行栈直到清空，再去读取任务队列。
* 当微任务中的任务执行完成后会读取宏任务的一个任务加入微任务，接着继续执行微任务，依次执行下去直到所有任务执行结束。
  
⚠️注意：Promise本身是同步的立即执行函数，当在函数中执行resolve/reject的时候此时是异步操作，回西安执行then/catch，当主栈完成后才会去调用resolve/reject中存放当方法执行